<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        .wide-container {
            max-width: 90%;
        }
        .full-height {
            height: auto;
        }
        .thin-grey-border th,
        .thin-grey-border td {
            border: 1px solid #dee2e6;
        }
        .small-text {
            font-size: 0.85rem;
        }
        .custom-table-header {
            background-color: #F1F5FA;
        }
        .card-header .card-title {
            margin-bottom: 0.25rem;
        }
        .card-header small {
            margin-bottom: 0.5rem;
        }
    </style>
</head>

<body>

<div th:replace="fragments/navbar :: navbar"></div>

<div class="container-fluid bg-light wide-container full-height p-4">

    <div class="row mb-4">
       <div class="col">
            <h4>Your Portfolio</h4>
        </div>
    </div>

    <div th:if="${successMessage}" class="alert alert-success text-center text-dark fs-5" role="alert"><span th:text="${successMessage}"></span></div>
    <div th:if="${errorMessage}" class="alert alert-danger text-center text-dark fs-5" role="alert"><span th:text="${errorMessage}"></span></div>

    <div class="row mb-4 g-3">
        <!-- Stock data and company summary cards -->
        <div class="col d-flex flex-column justify-content-start gap-3">
            <div class="d-flex gap-4">
                <!-- Stock information cards -->
                <div class="card" style="width: 18rem; height: 8rem;">
                    <div class="card-header">Current Balance</div>
                    <div class="card-body d-flex align-items-center h-100">
                        <h4 class="m-0" th:text="'$' + (${balance} != null ? ${#numbers.formatDecimal(balance, 1, 'COMMA', 2, 'POINT')} : '0.00')"></h4>
                    </div>
                </div>
                <div class="card" style="width: 18rem; height: 8rem;">
                    <div class="card-header">Total Cost</div>
                    <div class="card-body d-flex align-items-center h-100">
                        <h4 class="m-0" th:text="'$' + (${totalCost} != null ? ${#numbers.formatDecimal(totalCost, 2, 'COMMA', 2, 'POINT')} : '0.00')"></h4>
                    </div>
                </div>
                <div class="card" style="width: 18rem; height: 8rem;">
                    <div class="card-header">Total Value</div>
                    <div class="card-body d-flex align-items-center h-100">
                        <h4 class="m-0" th:text="'$' + (${totalValue} != null ? ${#numbers.formatDecimal(totalValue, 2, 'COMMA', 2, 'POINT')} : '0.00')"></h4>
                    </div>
                </div>
                <div class="card" style="width: 18rem; height: 8rem;">
                    <div class="card-header">Total Change</div>
                    <div class="card-body d-flex align-items-center h-100">
                        <h4 class="m-0">
                            <span th:text="'$' + (${totalChangeValue} != null ? ${#numbers.formatDecimal(totalChangeValue, 2, 'COMMA', 2, 'POINT')} : '0.00')"></span>
                            (<span th:class="${totalChangePercent >= 0 ? 'text-success' : 'text-danger'}"
                                   th:text="(${totalChangePercent} != null ? ${#numbers.formatDecimal(totalChangePercent, 1, 'COMMA', 2, 'POINT')} : '0.00') + '%'"></span>)
                        </h4>
                    </div>
                </div>
            </div>

            <div class="card mb-4" style="width: 76.5rem; height: 40rem;">
                <div class="card-header">Investments</div>
                <div class="card-body p-4 pb-2">
                    <table class="table table-hover mb-0 thin-grey-border small-text">
                        <thead class="text-center custom-table-header">
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Quantity</th>
                            <th scope="col">Purchase Price</th>
                            <th scope="col">Cost</th>
                            <th scope="col">Value</th>
                            <th scope="col">Change</th>
                            <th scope="col">Actions</th>
                        </tr>
                        </thead>
                        <tbody class="text-center">

                        <tr th:each="item, iterStat : ${portfolio.items}">
                            <td class="align-middle text-center" th:text="${item.stock.name}"></td>
                            <td class="align-middle text-center">
                                <span th:if="${editingItemId != item.id}" th:text="${item.quantity}"></span>
                                <input class="form-control form-control-sm" style="text-align: center;" th:if="${editingItemId == item.id}" type="number" th:value="${item.quantity}" th:name="newQuantity" form="saveForm-${item.id}" />
                            </td>
                            <td class="align-middle text-center">
                                <span th:if="${editingItemId != item.id}" th:text="${#numbers.formatDecimal(item.purchasePrice, 1, 'COMMA', 2, 'POINT')}"></span>
                                <input class="form-control form-control-sm" style="text-align: center;" th:if="${editingItemId == item.id}" type="text" th:value="${item.purchasePrice}" th:name="newPurchasePrice" form="saveForm-${item.id}" />
                            </td>
                            <td class="align-middle text-center" th:text="${#numbers.formatDecimal(item.quantity * item.purchasePrice, 1, 'COMMA', 2, 'POINT')}"></td>
                            <td class="align-middle text-center" th:text="${#numbers.formatDecimal(item.quantity * item.stock.currentPrice, 1, 'COMMA', 2, 'POINT')}"></td>
                            <td class="align-middle text-center" th:text="${#numbers.formatDecimal((item.stock.currentPrice - item.purchasePrice) * item.quantity, 1, 'COMMA', 2, 'POINT')}"></td>
                            <td class="align-middle text-center">
                                <form th:if="${editingItemId == item.id}" id="saveForm-${item.id}" th:action="@{/portfolio/save}" method="post" class="d-inline-block">
                                    <input type="hidden" th:name="id" th:value="${item.id}" />
                                    <button type="submit" class="btn btn-primary btn-sm" title="Save">Save</button>
                                </form>
                                <a th:if="${editingItemId != item.id}" th:href="@{/portfolio/edit/(id=${item.id})}" class="bi bi-pencil-square mx-1" title="Edit"></a>
                                <a th:if="${editingItemId != item.id}" th:href="@{/portfolio/delete/(id=${item.id})}" class="bi bi-trash mx-1" title="Delete"></a>
                            </td>
                        </tr>

<!--                        <tr th:each="item, iterStat : ${portfolio.items}">-->
<!--                            <td th:text="${item.stock.name}"></td>-->
<!--                            <td>-->
<!--                                <span th:if="${editingItemId != item.id}" th:text="${item.quantity}"></span>-->
<!--                                <input th:if="${editingItemId == item.id}" type="number" th:value="${item.quantity}" th:name="'quantity-' + ${item.id}" />-->
<!--                            </td>-->
<!--                            <td>-->
<!--                                <span th:if="${editingItemId != item.id}" th:text="${#numbers.formatDecimal(item.purchasePrice, 1, 'COMMA', 2, 'POINT')}"></span>-->
<!--                                <input th:if="${editingItemId == item.id}" type="text" th:value="${item.purchasePrice}" th:name="'purchasePrice-' + ${item.id}" />-->
<!--                            </td>-->
<!--                            <td th:text="${#numbers.formatDecimal(item.quantity * item.purchasePrice, 1, 'COMMA', 2, 'POINT')}"></td>-->
<!--                            <td th:text="${#numbers.formatDecimal(item.quantity * item.stock.currentPrice, 1, 'COMMA', 2, 'POINT')}"></td>-->
<!--                            <td th:text="${#numbers.formatDecimal((item.stock.currentPrice - item.purchasePrice) * item.quantity, 1, 'COMMA', 2, 'POINT')}"></td>-->
<!--                            <td>-->
<!--                                <a th:if="${editingItemId != item.id}" th:href="@{/portfolio/edit/(id=${item.id})}" class="bi bi-pencil-square" title="Edit"></a>-->
<!--                                <a th:if="${editingItemId == item.id}" th:href="@{/portfolio/save/(id=${item.id})}" class="btn btn-primary" title="Save">Save</a>-->
<!--                                <a href="@{/portfolio/delete/(id=${item.id})}" class="bi bi-trash" title="Delete"></a>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        <tr th:each="item, iterStat : ${portfolio.items}">-->
<!--                            <td th:text="${item.stock.name}"></td>-->
<!--                            <td th:text="${item.quantity}"></td>-->
<!--                            <td th:text="${#numbers.formatDecimal(item.purchasePrice, 1, 'COMMA', 2, 'POINT')}"></td>-->
<!--                            <td th:text="${#numbers.formatDecimal(item.quantity * item.purchasePrice, 1, 'COMMA', 2, 'POINT')}"></td>-->
<!--                            <td th:text="${#numbers.formatDecimal(item.quantity * item.stock.currentPrice, 1, 'COMMA', 2, 'POINT')}"></td>-->
<!--                            <td th:text="${#numbers.formatDecimal((item.stock.currentPrice - item.purchasePrice) * item.quantity, 1, 'COMMA', 2, 'POINT')}"></td>-->
<!--                            <td>-->
<!--                                <i class="bi bi-pencil-square" title="Edit"></i> |-->
<!--                                <i class="bi bi-trash" title="Delete"></i>-->
<!--                            </td>-->
<!--                        </tr>-->
                        <tr th:unless="${portfolio.items.size() > 0}" th:each="i : ${#numbers.sequence(1, 12)}">
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <nav aria-label="Page navigation" class="text-end pe-4">
                    <ul class="pagination pagination-sm justify-content-end mb-4">
                        <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                        <li class="page-item active" aria-current="page"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">Next</a></li>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="ms-auto" style="width: 22rem;">
            <!-- Balance Card -->
            <div class="card mb-3" style="height: 8rem;">
                <div class="card-header"></div>
                <div class="card-body">
                </div>
            </div>
            <!-- Buy/Sell Card -->
            <div class="card" style="height: 40rem;">
                <div class="card-header">

                </div>
                <div class="card-body">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>